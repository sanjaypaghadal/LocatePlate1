USE [LocatePlate]
GO
/****** Object:  StoredProcedure [dbo].[GetAllCuisine]    Script Date: 2/6/2021 3:03:55 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Sarabjeet Singh
-- Create Date: 1/24/2021
-- Description: Get all unique cuisine
-- =============================================
ALTER PROCEDURE [dbo].[GetAllCuisine]
AS
BEGIN
    SET NOCOUNT ON
	       DECLARE @query VARCHAR(max)='';
		   SELECT @query = @query + cuisine + ','
		   FROM   [dbo].[restaurants]
		   WHERE  cuisine IS NOT NULL;
		   SELECT @query = dbo.Distinctlist(@query, ',')
		   SELECT *,Id=Newid(),Name= ''
		   FROM   dbo.Breakstringintorows(@query) 
END







USE [LocatePlate]
GO
/****** Object:  UserDefinedFunction [dbo].[BreakStringIntoRows]    Script Date: 2/6/2021 3:05:38 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

		ALTER FUNCTION [dbo].[BreakStringIntoRows] (@CommadelimitedString   varchar(max))
RETURNS   @Result TABLE (Column1   VARCHAR(100))
AS
BEGIN
        DECLARE @IntLocation INT
        WHILE (CHARINDEX(',',    @CommadelimitedString, 0) > 0)
        BEGIN
              SET @IntLocation =   CHARINDEX(',',    @CommadelimitedString, 0)      
              INSERT INTO   @Result (Column1)
              --LTRIM and RTRIM to ensure blank spaces are   removed
              SELECT RTRIM(LTRIM(SUBSTRING(@CommadelimitedString,   0, @IntLocation)))   
              SET @CommadelimitedString = STUFF(@CommadelimitedString,   1, @IntLocation,   '') 
        END
        INSERT INTO   @Result (Column1)
        SELECT RTRIM(LTRIM(@CommadelimitedString))--LTRIM and RTRIM to ensure blank spaces are removed
        RETURN 
END


USE [LocatePlate]
GO
/****** Object:  UserDefinedFunction [dbo].[DistinctList]    Script Date: 2/6/2021 3:05:50 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER FUNCTION [dbo].[DistinctList]
(
@List VARCHAR(MAX),
@Delim CHAR
)
RETURNS
VARCHAR(MAX)
AS
BEGIN
DECLARE @ParsedList TABLE
(
Item VARCHAR(MAX)
)
DECLARE @list1 VARCHAR(MAX), @Pos INT, @rList VARCHAR(MAX)
SET @list = LTRIM(RTRIM(@list)) + @Delim
SET @pos = CHARINDEX(@delim, @list, 1)
WHILE @pos > 0
BEGIN
SET @list1 = LTRIM(RTRIM(LEFT(@list, @pos - 1)))
IF @list1 <> ''
INSERT INTO @ParsedList VALUES (CAST(@list1 AS VARCHAR(MAX)))
SET @list = SUBSTRING(@list, @pos+1, LEN(@list))
SET @pos = CHARINDEX(@delim, @list, 1)
END
SELECT @rlist = COALESCE(@rlist+',','') + item
FROM (SELECT DISTINCT Item FROM @ParsedList) t
RETURN @rlist
END


